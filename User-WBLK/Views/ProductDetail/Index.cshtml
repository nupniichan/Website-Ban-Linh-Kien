@model ProductDetailViewModel
@{
    ViewData["Title"] = Model.Name;
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="container mx-auto px-4 py-8">
    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
        <!-- Product Images -->
        <div class="space-y-4">
            <div class="bg-white p-4 rounded-lg shadow-md">
                @* Nào có data thì tui mở lại sau*@
                @* <img src="@Model.ImageUrl" alt="@Model.Name" class="w-full h-auto rounded-lg"> *@
                <img src="/imgs/products/cpu-amd.jpg" 
                     class="w-full h-[500px] object-contain rounded-lg" 
                     alt="@Model.Name">
            </div>
            @if (Model.AdditionalImages?.Any() == true)
            {
                <div class="grid grid-cols-4 gap-4">
                    @foreach (var image in Model.AdditionalImages)
                    {
                        <div class="bg-white p-2 rounded-lg shadow-md hover:shadow-lg transition-shadow cursor-pointer">
                            <img src="@image" 
                                 class="w-full h-[100px] object-contain rounded-lg"
                                 alt="@Model.Name">
                        </div>
                    }
                </div>
            }
        </div>

        <!-- Product Info -->
        <div class="space-y-6">
            <div class="bg-white p-6 rounded-lg shadow-md">
                <div class="space-y-4">
                    <!-- Product Title -->
                    <h1 class="text-2xl md:text-3xl font-bold">@Model.Name</h1>

                    <!-- Product Info Grid -->
                    <div class="space-y-1">
                        <!-- Row 1 -->
                        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
                            <div class="flex items-center space-x-2">
                                <span class="text-gray-600 whitespace-nowrap">Mã SP:</span>
                                <span class="text-[#007AFF] font-medium">@Model.ProductCode</span>
                            </div>
                            <div class="flex items-center space-x-2">
                                <span class="text-gray-600 whitespace-nowrap">Bảo hành:</span>
                                <span class="text-[#FF0000] font-medium">@Model.Warranty tháng</span>
                            </div>
                            <div class="flex items-center space-x-2">
                                <span class="text-gray-600 whitespace-nowrap">Tình trạng:</span>
                                <span class="text-[#FFB800] font-medium">@(Model.InStock ? "Còn hàng" : "Hết hàng")</span>
                            </div>
                        </div>

                        <!-- Row 2 -->
                        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
                            <div class="flex items-center space-x-2">
                                <span class="text-gray-600 whitespace-nowrap">Số lượt xem:</span>
                                <span class="text-[#007AFF] font-medium">@Model.ViewCount</span>
                            </div>
                            <div class="flex items-center space-x-2">
                                <span class="text-gray-600 whitespace-nowrap">Đã mua:</span>
                                <span class="text-[#007AFF] font-medium">@Model.PurchaseCount</span>
                            </div>
                            <div class="flex items-center space-x-2">
                                <span class="text-gray-600 whitespace-nowrap">Đánh giá:</span>
                                <span class="text-[#007AFF] font-medium">@Model.Rating</span>
                            </div>
                        </div>
                    </div>

                    <!-- Price -->
                    <div class="bg-gray-100 rounded-lg p-4">
                        <span class="text-3xl font-bold text-[#FF0000]">@Model.Price.ToString("N0")đ</span>
                    </div>

                    <!-- Quantity -->
                    <div class="flex items-center gap-4">
                        <span class="text-gray-600">Số lượng:</span>
                        <div class="flex border rounded">
                            <button class="px-3 py-1 border-r hover:bg-gray-100">-</button>
                            <input type="number" 
                                   value="1" 
                                   class="w-16 text-center [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none" />
                            <button class="px-3 py-1 border-l hover:bg-gray-100">+</button>
                        </div>
                    </div>

                    <!-- Action Buttons -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <button class="w-full px-4 py-3 border-2 border-[#007AFF] text-[#007AFF] rounded-lg hover:bg-blue-50 font-medium">
                            THÊM VÀO GIỎ
                        </button>
                        <button class="w-full px-4 py-3 bg-[#007AFF] text-white rounded-lg hover:bg-blue-600 font-medium">
                            MUA NGAY
                        </button>
                    </div>

                    <!-- Purchase Assurance -->
                    <div class="mt-6">
                        <h3 class="font-medium text-lg mb-4">Yên tâm mua hàng</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div class="flex items-center gap-2">
                                <svg class="w-6 h-6 text-[#007AFF]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                                </svg>
                                <span>Cam kết giá tốt nhất thị trường</span>
                            </div>
                            <div class="flex items-center gap-2">
                                <svg class="w-6 h-6 text-[#007AFF]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4" />
                                </svg>
                                <span>Sản phẩm mới 100%</span>
                            </div>
                            <div class="flex items-center gap-2">
                                <svg class="w-6 h-6 text-[#007AFF]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                                </svg>
                                <span>Lỗi 1 đổi 1 ngay lập tức</span>
                            </div>
                            <div class="flex items-center gap-2">
                                <svg class="w-6 h-6 text-[#007AFF]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z" />
                                </svg>
                                <span>Bảo hành chính hãng</span>
                            </div>
                        </div>
                    </div>
                </div>

                @* @if (!string.IsNullOrEmpty(Model.Description) || Model.Specifications?.Any() == true)
                {
                    <div class="bg-white p-6 rounded-lg shadow-md mt-6">
                        <!-- Tab headers -->
                        <div class="border-b">
                            <div class="flex space-x-8">
                                <button class="text-lg font-semibold pb-4 border-b-2 border-[#007AFF] text-[#007AFF]" 
                                        onclick="switchTab('description')" 
                                        id="descriptionTab">
                                    Mô tả sản phẩm
                                </button>
                                <button class="text-lg font-semibold pb-4 border-b-2 border-transparent text-gray-500 hover:text-gray-700" 
                                        onclick="switchTab('specifications')" 
                                        id="specificationsTab">
                                    Thông số kỹ thuật
                                </button>
                            </div>
                        </div>

                        <!-- Tab contents -->
                        <div class="mt-6">
                            <!-- Description tab -->
                            <div id="descriptionContent" class="prose max-w-none">
                                @if (!string.IsNullOrEmpty(Model.Description))
                                {
                                    <div class="text-gray-600">@Html.Raw(Model.Description)</div>
                                }
                            </div>

                            <!-- Specifications tab -->
                            <div id="specificationsContent" class="hidden">
                                @if (Model.Specifications?.Any() == true)
                                {
                                    <div class="grid grid-cols-1 gap-3">
                                        @foreach (var spec in Model.Specifications)
                                        {
                                            <div class="flex items-center bg-gray-50 p-3 rounded-lg">
                                                <span class="font-medium text-gray-600 w-1/3">@spec.Key:</span>
                                                <span class="text-gray-800">@spec.Value</span>
                                            </div>
                                        }
                                    </div>
                                }
                            </div>
                        </div>
                    </div>
                } *@
            </div>
        </div>
    </div>

    <!-- Product Details Section -->
    <div class="mt-8">
        <div class="bg-white p-6 rounded-lg shadow-md">
            <h2 class="text-xl font-bold mb-4">Thông tin sản phẩm</h2>
            
            <!-- Specifications Table -->
            <div class="border rounded-lg overflow-hidden">
                <!-- cai nay cua description ben admin them vao roi luu len database -->
            </div>

            <!-- Description -->
            <div class="mt-6">
                <h3 class="font-medium mb-3">Mô tả</h3>
                <div class="text-gray-600">
                    @Html.Raw(Model.Description)
                </div>
            </div>

            <!-- Reviews Section -->
            <div class="mt-8">
                <h2 class="text-xl font-bold mb-4">Đánh giá & nhận xét</h2>
                <div class="bg-white rounded-lg border">
                    <div class="flex flex-col sm:flex-row">
                        <!-- Rating Summary -->
                        <div class="text-center p-4 sm:border-r border-b sm:border-b-0 min-w-[150px] flex flex-col justify-center items-center">
                            <div class="text-[#007AFF] text-4xl font-bold">5/5</div>
                            <div class="text-gray-500">4 đánh giá</div>
                        </div>

                        <!-- Reviews List -->
                        <div class="flex-1 p-4">
                            <div id="reviewsList">
                                @{var initialReviews = Model.Reviews.Take(4);}
                                @foreach (var review in initialReviews)
                                {
                                    <div class="py-2">
                                        <div class="flex flex-wrap items-center gap-1">
                                            <span class="font-medium">@review.UserName - </span>
                                            <div class="flex text-yellow-400">
                                                @for (int i = 0; i < review.Rating; i++)
                                                {
                                                    <span>⭐</span>
                                                }
                                            </div>
                                        </div>
                                        <p class="text-gray-600 mt-1">@review.Comment</p>
                                    </div>
                                }
                            </div>
                            <div class="text-center mt-4">
                                @if (Model.Reviews.Count > 4)
                                {
                                    <button id="showMoreBtn" 
                                            class="bg-blue-500 text-white px-6 py-1.5 rounded-lg hover:bg-blue-600 transition-colors text-sm"
                                            onclick="toggleReviews()">
                                        Xem thêm
                                    </button>
                                }
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Sản phẩm liên quan -->
            <div class="mt-8">
                <partial name="_ProductSection" model='new ProductSectionViewModel { 
                    Title = "Sản phẩm liên quan", 
                    Category = "cpu",
                    ViewAllLink = "/productslist/components/cpu" 
                }' />
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const thumbnails = document.querySelectorAll('.grid-cols-4 img');
            const mainImage = document.querySelector('.bg-white.p-4 img');

            thumbnails.forEach(thumb => {
                thumb.addEventListener('click', function() {
                    mainImage.src = this.src;
                });
            });
        });
        
        function switchTab(tabName) {
            // Hide all contents
            document.getElementById('descriptionContent').classList.add('hidden');
            document.getElementById('specificationsContent').classList.add('hidden');
            
            // Remove active states
            document.getElementById('descriptionTab').classList.remove('border-[#007AFF]', 'text-[#007AFF]');
            document.getElementById('specificationsTab').classList.remove('border-[#007AFF]', 'text-[#007AFF]');
            document.getElementById('descriptionTab').classList.add('border-transparent', 'text-gray-500');
            document.getElementById('specificationsTab').classList.add('border-transparent', 'text-gray-500');
            
            // Show selected content and activate tab
            document.getElementById(tabName + 'Content').classList.remove('hidden');
            document.getElementById(tabName + 'Tab').classList.remove('border-transparent', 'text-gray-500');
            document.getElementById(tabName + 'Tab').classList.add('border-[#007AFF]', 'text-[#007AFF]');
        }

        let currentReviewCount = 4;
        const allReviews = @Json.Serialize(Model.Reviews);
        const showMoreBtn = document.getElementById('showMoreBtn');
        let isExpanded = false;
        
        function toggleReviews() {
            const reviewsList = document.getElementById('reviewsList');
            
            if (!isExpanded) {
                // Hiển thị thêm review
                const nextReviews = allReviews.slice(currentReviewCount, currentReviewCount + 4);
                
                nextReviews.forEach(review => {
                    const reviewElement = document.createElement('div');
                    reviewElement.className = 'py-2';
                    
                    const stars = '⭐'.repeat(review.rating);
                    reviewElement.innerHTML = `
                        <div class="flex flex-wrap items-center gap-1">
                            <span class="font-medium">${review.userName} - </span>
                            <div class="flex text-yellow-400">${stars}</div>
                        </div>
                        <p class="text-gray-600 mt-1">${review.comment}</p>
                    `;
                    
                    reviewsList.appendChild(reviewElement);
                });
                
                currentReviewCount += 4;
                
                // Nếu đã hiển thị hết review, đổi text thành "Ẩn bớt"
                if (currentReviewCount >= allReviews.length) {
                    showMoreBtn.textContent = 'Ẩn bớt';
                    isExpanded = true;
                }
            } else {
                // Ẩn bớt review, chỉ giữ lại 4 review đầu tiên
                const reviews = reviewsList.querySelectorAll('.py-2');
                for (let i = 4; i < reviews.length; i++) {
                    reviews[i].remove();
                }
                
                // Reset các biến
                currentReviewCount = 4;
                showMoreBtn.textContent = 'Xem thêm';
                isExpanded = false;
            }
        }
    </script>
}
