@model ProductListViewModel
@{
    ViewData["Title"] = "Linh kiện";
    Layout = "~/Views/Shared/_Layout.cshtml";

    // Định nghĩa các danh sách options
    var cpuSeries = new[] {
        new { Value = "", Text = "Dòng CPU" },
        new { Value = "Intel core", Text = "Intel Core" },
        new { Value = "Amd R4yzen", Text = "AMD Ryzen" }
    };
    
    var cores = new[] {
        new { Value = "", Text = "Số nhân" },
        new { Value = "4", Text = "4 nhân" },
        new { Value = "6", Text = "6 nhân" },
        new { Value = "8", Text = "8 nhân" }
    };
}
<div class="container mx-auto px-4">
    <!-- Categories -->
    <div class="bg-white rounded-lg p-4">
        <h2 class="font-semibold">Danh mục:</h2>
        <div class="flex flex-wrap gap-2">
            @{
                var categories = new[] {
                    ("cpu", "CPU"),
                    ("vga", "Card đồ họa"),
                    ("mainboard", "Bo mạch chủ"),
                    ("ram", "RAM"),
                    ("psu", "Nguồn máy tính"),
                    ("case", "Case máy tính")
                };
            }
            @foreach (var (value, text) in categories)
            {
                var parameters = new Dictionary<string, string>
                {
                    { "category", value }
                };
                
                var url = Url.Action("Components", "ProductsList", parameters);
                var isSelected = Model.Category == value;
                <a href="@url" class="px-4 py-2 bg-gray-100 rounded-md hover:bg-gray-200 @(isSelected ? "bg-blue-600 text-white" : "")">
                    @text
                </a>
            }
        </div>
    </div>

    <!-- Dynamic Filters based on category -->
    <div class="bg-white rounded-lg p-4 mt-4">
        <h2 class="font-semibold mb-4">Bộ lọc:</h2>
        @switch (Model?.Category?.ToLower())
        {
            case "cpu":
                <div class="space-y-4">
                    <div class="flex flex-wrap gap-2">
                        <!-- Brand Filter -->
                        <select id="brand" class="px-4 py-2 border rounded-md" onchange="window.location.href=this.value">
                            @{
                                var cpuBrandOptions = new[] {
                                    new { Value = "", Text = "Tất cả thương hiệu" },
                                    new { Value = "intel", Text = "Intel" },
                                    new { Value = "amd", Text = "AMD" }
                                };
                            }
                            @foreach (var brand in cpuBrandOptions)
                            {
                                var parameters = new Dictionary<string, string>
                                {
                                    { "category", "cpu" }
                                };
                                if (!string.IsNullOrEmpty(brand.Value))
                                    parameters.Add("brand", brand.Value);
                                if (Model.AdditionalFilters != null)
                                {
                                    if (Model.AdditionalFilters.ContainsKey("cpuSeries"))
                                        parameters.Add("cpuSeries", Model.AdditionalFilters["cpuSeries"]);
                                    if (Model.AdditionalFilters.ContainsKey("coreCount"))
                                        parameters.Add("coreCount", Model.AdditionalFilters["coreCount"]);
                                }
                                if (!string.IsNullOrEmpty(Model.PriceRange))
                                    parameters.Add("priceRange", Model.PriceRange);
                                
                                var url = Url.Action("Components", "ProductsList", parameters);
                                var isSelected = Model.Brand?.ToLower() == brand.Value.ToLower();
                                <option value="@url" selected="@isSelected">@brand.Text</option>
                            }
                        </select>

                        <!-- CPU Series Filter -->
                        <select id="cpuSeries" class="px-4 py-2 border rounded-md" onchange="window.location.href=this.value">
                            @{
                                var cpuSeriesOptions = new[] {
                                    new { Value = "", Text = "Tất cả dòng CPU" },
                                    new { Value = "intel core i9", Text = "Intel Core i9" },
                                    new { Value = "intel core i7", Text = "Intel Core i7" },
                                    new { Value = "intel core i5", Text = "Intel Core i5" },
                                    new { Value = "intel core i3", Text = "Intel Core i3" },
                                    new { Value = "amd ryzen 9", Text = "AMD Ryzen 9" },
                                    new { Value = "amd ryzen 7", Text = "AMD Ryzen 7" },
                                    new { Value = "amd ryzen 5", Text = "AMD Ryzen 5" },
                                    new { Value = "amd ryzen 3", Text = "AMD Ryzen 3" }
                                };
                            }
                            @foreach (var series in cpuSeriesOptions)
                            {
                                var parameters = new Dictionary<string, string>
                                {
                                    { "category", "cpu" }
                                };
                                if (!string.IsNullOrEmpty(Model.Brand))
                                    parameters.Add("brand", Model.Brand);
                                if (!string.IsNullOrEmpty(series.Value))
                                    parameters.Add("cpuSeries", series.Value);
                                if (!string.IsNullOrEmpty(Model.PriceRange))
                                    parameters.Add("priceRange", Model.PriceRange);
                                if (Model.AdditionalFilters != null && Model.AdditionalFilters.ContainsKey("coreCount"))
                                    parameters.Add("coreCount", Model.AdditionalFilters["coreCount"]);
                                
                                var url = Url.Action("Components", "ProductsList", parameters);
                                var isSelected = Model.AdditionalFilters?.GetValueOrDefault("cpuSeries")?.ToLower() == series.Value.ToLower();
                                <option value="@url" selected="@isSelected">@series.Text</option>
                            }
                        </select>

                        <!-- Core Count Filter -->
                        <select id="coreCount" class="px-4 py-2 border rounded-md" onchange="window.location.href=this.value">
                            @{
                                var coreCountOptions = new[] {
                                    new { Value = "", Text = "Tất cả số nhân" },
                                    new { Value = "4", Text = "4 nhân" },
                                    new { Value = "6", Text = "6 nhân" },
                                    new { Value = "8", Text = "8 nhân" },
                                    new { Value = "12", Text = "12 nhân" },
                                    new { Value = "16", Text = "16 nhân" },
                                    new { Value = "24", Text = "24 nhân" },
                                    new { Value = "32", Text = "32 nhân" }
                                };
                            }
                            @foreach (var coreOption in coreCountOptions)
                            {
                                var parameters = new Dictionary<string, string>
                                {
                                    { "category", "cpu" }
                                };
                                if (!string.IsNullOrEmpty(Model.Brand))
                                    parameters.Add("brand", Model.Brand);
                                if (!string.IsNullOrEmpty(coreOption.Value))
                                    parameters.Add("cores", coreOption.Value);
                                if (!string.IsNullOrEmpty(Model.PriceRange))
                                    parameters.Add("priceRange", Model.PriceRange);
                                if (Model.AdditionalFilters != null && Model.AdditionalFilters.ContainsKey("cpuSeries"))
                                    parameters.Add("cpuSeries", Model.AdditionalFilters["cpuSeries"]);
                                
                                var url = Url.Action("Components", "ProductsList", parameters);
                                var isSelected = Model.AdditionalFilters?.GetValueOrDefault("cores") == coreOption.Value;
                                <option value="@url" selected="@isSelected">@coreOption.Text</option>
                            }
                        </select>
                    </div>
                </div>
                break;

            case "vga":
                <div class="space-y-4">
                    <div class="flex flex-wrap gap-2">
                        <!-- Brand Filter -->
                        <select id="brand" class="px-4 py-2 border rounded-md" onchange="window.location.href=this.value">
                            @{
                                var vgaBrandOptions = new[] {
                                    new { Value = "", Text = "Tất cả thương hiệu" },
                                    new { Value = "nvidia", Text = "NVIDIA" },
                                    new { Value = "amd", Text = "AMD" },
                                    new { Value = "asus", Text = "ASUS" },
                                    new { Value = "msi", Text = "MSI" },
                                    new { Value = "gigabyte", Text = "Gigabyte" }
                                };
                            }
                            @foreach (var brand in vgaBrandOptions)
                            {
                                var parameters = new Dictionary<string, string>
                                {
                                    { "category", "vga" }
                                };
                                if (!string.IsNullOrEmpty(brand.Value))
                                    parameters.Add("brand", brand.Value);
                                if (Model.AdditionalFilters != null && Model.AdditionalFilters.ContainsKey("Bộ nhớ"))
                                    parameters.Add("Bộ nhớ", Model.AdditionalFilters["Bộ nhớ"]);
                                if (!string.IsNullOrEmpty(Model.PriceRange))
                                    parameters.Add("priceRange", Model.PriceRange);
                                
                                var url = Url.Action("Components", "ProductsList", parameters);
                                var isSelected = Model.Brand?.ToLower() == brand.Value.ToLower();
                                <option value="@url" selected="@isSelected">@brand.Text</option>
                            }
                        </select>

                        <!-- Memory Filter -->
                        <select id="memory" class="px-4 py-2 border rounded-md" onchange="window.location.href=this.value">
                            @{
                                var memoryOptions = new[] {
                                    new { Value = "", Text = "Tất cả dung lượng" },
                                    new { Value = "8GB GDDR6", Text = "8GB GDDR6" },
                                    new { Value = "12GB GDDR6", Text = "12GB GDDR6" },
                                    new { Value = "16GB GDDR6", Text = "16GB GDDR6" },
                                    new { Value = "24GB GDDR6", Text = "24GB GDDR6" }
                                };
                            }
                            @foreach (var memory in memoryOptions)
                            {
                                var parameters = new Dictionary<string, string>
                                {
                                    { "category", "vga" }
                                };
                                if (!string.IsNullOrEmpty(Model.Brand))
                                    parameters.Add("brand", Model.Brand);
                                if (!string.IsNullOrEmpty(memory.Value))
                                    parameters.Add("Bộ nhớ", memory.Value);
                                if (!string.IsNullOrEmpty(Model.PriceRange))
                                    parameters.Add("priceRange", Model.PriceRange);
                                
                                var url = Url.Action("Components", "ProductsList", parameters);
                                var isSelected = Model.AdditionalFilters?.GetValueOrDefault("Bộ nhớ") == memory.Value;
                                <option value="@url" selected="@isSelected">@memory.Text</option>
                            }
                        </select>
                    </div>
                </div>
                break;

            case "mainboard":
                <div class="space-y-4">
                    <div class="flex flex-wrap gap-2">
                        <!-- Brand Filter -->
                        <select id="brand" class="px-4 py-2 border rounded-md" onchange="window.location.href=this.value">
                            @{
                                var mainboardBrands = new[] {
                                    new { Value = "", Text = "Tất cả thương hiệu" },
                                    new { Value = "asus", Text = "ASUS" },
                                    new { Value = "msi", Text = "MSI" },
                                    new { Value = "gigabyte", Text = "Gigabyte" },
                                    new { Value = "asrock", Text = "ASRock" }
                                };
                            }
                            @foreach (var brand in mainboardBrands)
                            {
                                var parameters = new Dictionary<string, string>
                                {
                                    { "category", Model.Category }
                                };
                                if (!string.IsNullOrEmpty(brand.Value))
                                    parameters.Add("brand", brand.Value);
                                if (!string.IsNullOrEmpty(Model.PriceRange))
                                    parameters.Add("priceRange", Model.PriceRange);
                                if (Model.AdditionalFilters != null)
                                {
                                    if (Model.AdditionalFilters.ContainsKey("socket"))
                                        parameters.Add("socket", Model.AdditionalFilters["socket"]);
                                    if (Model.AdditionalFilters.ContainsKey("chipset"))
                                        parameters.Add("chipset", Model.AdditionalFilters["chipset"]);
                                    if (Model.AdditionalFilters.ContainsKey("formFactor"))
                                        parameters.Add("formFactor", Model.AdditionalFilters["formFactor"]);
                                }
                                
                                var url = Url.Action("Components", "ProductsList", parameters);
                                var isSelected = Model.Brand == brand.Value;
                                <option value="@url" selected="@isSelected">@brand.Text</option>
                            }
                        </select>

                        <!-- Socket Filter -->
                        <select id="socket" class="px-4 py-2 border rounded-md" onchange="window.location.href=this.value">
                            @{
                                var sockets = new[] {
                                    new { Value = "", Text = "Tất cả socket" },
                                    new { Value = "lga1700", Text = "LGA 1700" },
                                    new { Value = "am5", Text = "AM5" },
                                    new { Value = "am4", Text = "AM4" }
                                };
                            }
                            @foreach (var socket in sockets)
                            {
                                var parameters = new Dictionary<string, string>
                                {
                                    { "category", Model.Category }
                                };
                                if (!string.IsNullOrEmpty(Model.Brand))
                                    parameters.Add("brand", Model.Brand);
                                if (!string.IsNullOrEmpty(socket.Value))
                                    parameters.Add("socket", socket.Value);
                                if (!string.IsNullOrEmpty(Model.PriceRange))
                                    parameters.Add("priceRange", Model.PriceRange);
                                if (Model.AdditionalFilters != null)
                                {
                                    if (Model.AdditionalFilters.ContainsKey("chipset"))
                                        parameters.Add("chipset", Model.AdditionalFilters["chipset"]);
                                    if (Model.AdditionalFilters.ContainsKey("formFactor"))
                                        parameters.Add("formFactor", Model.AdditionalFilters["formFactor"]);
                                }
                                
                                var url = Url.Action("Components", "ProductsList", parameters);
                                var isSelected = Model.AdditionalFilters?.GetValueOrDefault("socket") == socket.Value;
                                <option value="@url" selected="@isSelected">@socket.Text</option>
                            }
                        </select>

                        <!-- Chipset Filter -->
                        <select id="chipset" class="px-4 py-2 border rounded-md" onchange="window.location.href=this.value">
                            @{
                                var chipsets = new[] {
                                    new { Value = "", Text = "Tất cả chipset" },
                                    new { Value = "z790", Text = "Z790" },
                                    new { Value = "b760", Text = "B760" },
                                    new { Value = "x670", Text = "X670" },
                                    new { Value = "b650", Text = "B650" }
                                };
                            }
                            @foreach (var chipset in chipsets)
                            {
                                var parameters = new Dictionary<string, string>
                                {
                                    { "category", Model.Category }
                                };
                                if (!string.IsNullOrEmpty(Model.Brand))
                                    parameters.Add("brand", Model.Brand);
                                if (!string.IsNullOrEmpty(chipset.Value))
                                    parameters.Add("chipset", chipset.Value);
                                if (!string.IsNullOrEmpty(Model.PriceRange))
                                    parameters.Add("priceRange", Model.PriceRange);
                                if (Model.AdditionalFilters != null)
                                {
                                    if (Model.AdditionalFilters.ContainsKey("formFactor"))
                                        parameters.Add("formFactor", Model.AdditionalFilters["formFactor"]);
                                }
                                
                                var url = Url.Action("Components", "ProductsList", parameters);
                                var isSelected = Model.AdditionalFilters?.GetValueOrDefault("chipset") == chipset.Value;
                                <option value="@url" selected="@isSelected">@chipset.Text</option>
                            }
                        </select>

                        <!-- Form Factor Filter -->
                        <select id="formFactor" class="px-4 py-2 border rounded-md" onchange="window.location.href=this.value">
                            @{
                                var formFactors = new[] {
                                    new { Value = "", Text = "Tất cả kích thước" },
                                    new { Value = "atx", Text = "ATX" },
                                    new { Value = "matx", Text = "Micro-ATX" },
                                    new { Value = "itx", Text = "Mini-ITX" }
                                };
                            }
                            @foreach (var formFactor in formFactors)
                            {
                                var parameters = new Dictionary<string, string>
                                {
                                    { "category", Model.Category }
                                };
                                if (!string.IsNullOrEmpty(Model.Brand))
                                    parameters.Add("brand", Model.Brand);
                                if (!string.IsNullOrEmpty(formFactor.Value))
                                    parameters.Add("formFactor", formFactor.Value);
                                if (!string.IsNullOrEmpty(Model.PriceRange))
                                    parameters.Add("priceRange", Model.PriceRange);
                                if (Model.AdditionalFilters != null)
                                {
                                    if (Model.AdditionalFilters.ContainsKey("chipset"))
                                        parameters.Add("chipset", Model.AdditionalFilters["chipset"]);
                                }
                                
                                var url = Url.Action("Components", "ProductsList", parameters);
                                var isSelected = Model.AdditionalFilters?.GetValueOrDefault("formFactor") == formFactor.Value;
                                <option value="@url" selected="@isSelected">@formFactor.Text</option>
                            }
                        </select>
                    </div>
                </div>
                break;

            case "ram":
                <div class="space-y-4">
                    <div class="flex flex-wrap gap-2">
                        <!-- Brand Filter -->
                        <select id="brand" class="px-4 py-2 border rounded-md" onchange="window.location.href=this.value">
                            @{
                                var ramBrands = new[] {
                                    new { Value = "", Text = "Tất cả thương hiệu" },
                                    new { Value = "corsair", Text = "Corsair" },
                                    new { Value = "gskill", Text = "G.Skill" },
                                    new { Value = "kingston", Text = "Kingston" },
                                    new { Value = "crucial", Text = "Crucial" }
                                };
                            }
                            @foreach (var brand in ramBrands)
                            {
                                var parameters = new Dictionary<string, string>
                                {
                                    { "category", Model.Category }
                                };
                                if (!string.IsNullOrEmpty(brand.Value))
                                    parameters.Add("brand", brand.Value);
                                if (!string.IsNullOrEmpty(Model.PriceRange))
                                    parameters.Add("priceRange", Model.PriceRange);
                                
                                var url = Url.Action("Components", "ProductsList", parameters);
                                var isSelected = Model.Brand == brand.Value;
                                <option value="@url" selected="@isSelected">@brand.Text</option>
                            }
                        </select>
                    </div>
                </div>
                break;

            case "psu":
                <div class="space-y-4">
                    <div class="flex flex-wrap gap-2">
                        <!-- Brand Filter -->
                        <select id="brand" class="px-4 py-2 border rounded-md" onchange="window.location.href=this.value">
                            @{
                                var psuBrands = new[] {
                                    new { Value = "", Text = "Tất cả thương hiệu" },
                                    new { Value = "corsair", Text = "Corsair" },
                                    new { Value = "seasonic", Text = "Seasonic" },
                                    new { Value = "evga", Text = "EVGA" },
                                    new { Value = "cooler master", Text = "Cooler Master" }
                                };
                            }
                            @foreach (var brand in psuBrands)
                            {
                                var parameters = new Dictionary<string, string>
                                {
                                    { "category", Model.Category }
                                };
                                if (!string.IsNullOrEmpty(brand.Value))
                                    parameters.Add("brand", brand.Value);
                                if (!string.IsNullOrEmpty(Model.PriceRange))
                                    parameters.Add("priceRange", Model.PriceRange);
                                
                                var url = Url.Action("Components", "ProductsList", parameters);
                                var isSelected = Model.Brand == brand.Value;
                                <option value="@url" selected="@isSelected">@brand.Text</option>
                            }
                        </select>

                        <!-- Wattage Filter -->
                        <select id="wattage" class="px-4 py-2 border rounded-md" onchange="window.location.href=this.value">
                            @{
                                var wattages = new[] {
                                    new { Value = "", Text = "Tất cả công suất" },
                                    new { Value = "550", Text = "550W" },
                                    new { Value = "650", Text = "650W" },
                                    new { Value = "750", Text = "750W" },
                                    new { Value = "850", Text = "850W" },
                                    new { Value = "1000", Text = "1000W" }
                                };
                            }
                            @foreach (var wattage in wattages)
                            {
                                var parameters = new Dictionary<string, string>
                                {
                                    { "category", Model.Category }
                                };
                                if (!string.IsNullOrEmpty(Model.Brand))
                                    parameters.Add("brand", Model.Brand);
                                if (!string.IsNullOrEmpty(wattage.Value))
                                    parameters.Add("wattage", wattage.Value);
                                if (!string.IsNullOrEmpty(Model.PriceRange))
                                    parameters.Add("priceRange", Model.PriceRange);
                                
                                var url = Url.Action("Components", "ProductsList", parameters);
                                var isSelected = Model.AdditionalFilters != null && 
                                                Model.AdditionalFilters.ContainsKey("wattage") && 
                                                Model.AdditionalFilters["wattage"] == wattage.Value;
                                
                                <option value="@url" selected="@isSelected">@wattage.Text</option>
                            }
                        </select>

                        <!-- Efficiency Filter -->
                        <select id="efficiency" class="px-4 py-2 border rounded-md" onchange="window.location.href=this.value">
                            @{
                                var efficiencies = new[] {
                                    new { Value = "", Text = "Tất cả hiệu suất" },
                                    new { Value = "80plus", Text = "80 PLUS Standard" },
                                    new { Value = "80plus-bronze", Text = "80 PLUS Bronze" },
                                    new { Value = "80plus-gold", Text = "80 PLUS Gold" },
                                    new { Value = "80plus-platinum", Text = "80 PLUS Platinum" }
                                };
                            }
                            @foreach (var efficiency in efficiencies)
                            {
                                var parameters = new Dictionary<string, string>
                                {
                                    { "category", Model.Category }
                                };
                                if (!string.IsNullOrEmpty(Model.Brand))
                                    parameters.Add("brand", Model.Brand);
                                if (!string.IsNullOrEmpty(efficiency.Value))
                                    parameters.Add("efficiency", efficiency.Value);
                                if (!string.IsNullOrEmpty(Model.PriceRange))
                                    parameters.Add("priceRange", Model.PriceRange);
                                
                                var url = Url.Action("Components", "ProductsList", parameters);
                                var isSelected = Model.AdditionalFilters != null && 
                                                Model.AdditionalFilters.ContainsKey("efficiency") && 
                                                Model.AdditionalFilters["efficiency"] == efficiency.Value;
                                
                                <option value="@url" selected="@isSelected">@efficiency.Text</option>
                            }
                        </select>

                        <!-- Modular Filter -->
                        <select id="modular" class="px-4 py-2 border rounded-md" onchange="window.location.href=this.value">
                            @{
                                var modularTypes = new[] {
                                    new { Value = "", Text = "Tất cả kiểu dây" },
                                    new { Value = "full", Text = "Full Modular" },
                                    new { Value = "semi", Text = "Semi Modular" },
                                    new { Value = "non", Text = "Non Modular" }
                                };
                            }
                            @foreach (var modular in modularTypes)
                            {
                                var parameters = new Dictionary<string, string>
                                {
                                    { "category", Model.Category }
                                };
                                if (!string.IsNullOrEmpty(Model.Brand))
                                    parameters.Add("brand", Model.Brand);
                                if (!string.IsNullOrEmpty(modular.Value))
                                    parameters.Add("modular", modular.Value);
                                if (!string.IsNullOrEmpty(Model.PriceRange))
                                    parameters.Add("priceRange", Model.PriceRange);
                                
                                var url = Url.Action("Components", "ProductsList", parameters);
                                var isSelected = Model.AdditionalFilters != null && 
                                                Model.AdditionalFilters.ContainsKey("modular") && 
                                                Model.AdditionalFilters["modular"] == modular.Value;
                                
                                <option value="@url" selected="@isSelected">@modular.Text</option>
                            }
                        </select>
                    </div>
                </div>
                break;

            case "case":
                <div class="space-y-4">
                    <div class="flex flex-wrap gap-2">
                        <!-- Brand Filter -->
                        <select id="brand" class="px-4 py-2 border rounded-md" onchange="window.location.href=this.value">
                            @{
                                var caseBrands = new[] {
                                    new { Value = "", Text = "Tất cả thương hiệu" },
                                    new { Value = "nzxt", Text = "NZXT" },
                                    new { Value = "lian li", Text = "Lian Li" },
                                    new { Value = "phanteks", Text = "Phanteks" },
                                    new { Value = "cooler master", Text = "Cooler Master" }
                                };
                            }
                            @foreach (var brand in caseBrands)
                            {
                                var parameters = new Dictionary<string, string>
                                {
                                    { "category", Model.Category }
                                };
                                if (!string.IsNullOrEmpty(brand.Value))
                                    parameters.Add("brand", brand.Value);
                                if (!string.IsNullOrEmpty(Model.PriceRange))
                                    parameters.Add("priceRange", Model.PriceRange);
                                
                                var url = Url.Action("Components", "ProductsList", parameters);
                                var isSelected = Model.Brand == brand.Value;
                                <option value="@url" selected="@isSelected">@brand.Text</option>
                            }
                        </select>

                        <!-- Form Factor Filter -->
                        <select id="caseSize" class="px-4 py-2 border rounded-md" onchange="window.location.href=this.value">
                            @{
                                var caseSizes = new[] {
                                    new { Value = "", Text = "Tất cả kích thước" },
                                    new { Value = "full-tower", Text = "Full Tower" },
                                    new { Value = "mid-tower", Text = "Mid Tower" },
                                    new { Value = "mini-tower", Text = "Mini Tower" }
                                };
                            }
                            @foreach (var size in caseSizes)
                            {
                                var parameters = new Dictionary<string, string>
                                {
                                    { "category", Model.Category }
                                };
                                if (!string.IsNullOrEmpty(Model.Brand))
                                    parameters.Add("brand", Model.Brand);
                                if (!string.IsNullOrEmpty(size.Value))
                                    parameters.Add("caseSize", size.Value);
                                if (!string.IsNullOrEmpty(Model.PriceRange))
                                    parameters.Add("priceRange", Model.PriceRange);
                                
                                var url = Url.Action("Components", "ProductsList", parameters);
                                var isSelected = Model.AdditionalFilters != null && 
                                                Model.AdditionalFilters.ContainsKey("caseSize") && 
                                                Model.AdditionalFilters["caseSize"] == size.Value;
                                
                                <option value="@url" selected="@isSelected">@size.Text</option>
                            }
                        </select>

                        <!-- Color Filter -->
                        <select id="color" class="px-4 py-2 border rounded-md" onchange="window.location.href=this.value">
                            @{
                                var colors = new[] {
                                    new { Value = "", Text = "Tất cả màu sắc" },
                                    new { Value = "black", Text = "Đen" },
                                    new { Value = "white", Text = "Trắng" },
                                    new { Value = "rgb", Text = "RGB" }
                                };
                            }
                            @foreach (var color in colors)
                            {
                                var parameters = new Dictionary<string, string>
                                {
                                    { "category", Model.Category }
                                };
                                if (!string.IsNullOrEmpty(Model.Brand))
                                    parameters.Add("brand", Model.Brand);
                                if (!string.IsNullOrEmpty(color.Value))
                                    parameters.Add("color", color.Value);
                                if (!string.IsNullOrEmpty(Model.PriceRange))
                                    parameters.Add("priceRange", Model.PriceRange);
                                
                                var url = Url.Action("Components", "ProductsList", parameters);
                                var isSelected = Model.AdditionalFilters != null && 
                                                Model.AdditionalFilters.ContainsKey("color") && 
                                                Model.AdditionalFilters["color"] == color.Value;
                                
                                <option value="@url" selected="@isSelected">@color.Text</option>
                            }
                        </select>

                        <!-- Side Panel Filter -->
                        <select id="sidePanel" class="px-4 py-2 border rounded-md" onchange="window.location.href=this.value">
                            @{
                                var sidePanels = new[] {
                                    new { Value = "", Text = "Tất cả loại mặt hông" },
                                    new { Value = "tempered-glass", Text = "Kính cường lực" },
                                    new { Value = "acrylic", Text = "Acrylic" },
                                    new { Value = "solid", Text = "Panel kim loại" }
                                };
                            }
                            @foreach (var panel in sidePanels)
                            {
                                var parameters = new Dictionary<string, string>
                                {
                                    { "category", Model.Category }
                                };
                                if (!string.IsNullOrEmpty(Model.Brand))
                                    parameters.Add("brand", Model.Brand);
                                if (!string.IsNullOrEmpty(panel.Value))
                                    parameters.Add("sidePanel", panel.Value);
                                if (!string.IsNullOrEmpty(Model.PriceRange))
                                    parameters.Add("priceRange", Model.PriceRange);
                                
                                var url = Url.Action("Components", "ProductsList", parameters);
                                var isSelected = Model.AdditionalFilters != null && 
                                                Model.AdditionalFilters.ContainsKey("sidePanel") && 
                                                Model.AdditionalFilters["sidePanel"] == panel.Value;
                                
                                <option value="@url" selected="@isSelected">@panel.Text</option>
                            }
                        </select>
                    </div>
                </div>
                break;

            case null:
            case "":
                <script>
                    window.location.href = '@Url.Action("Components", "ProductsList", new { category = "cpu" })';
                </script>
                break;

            default:
                <div class="text-center py-4 text-gray-500">
                    Không tìm thấy danh mục phù hợp
                </div>
                break;
        }

        <!-- Price Range -->
        <div class="mt-4">
            <h2 class="font-semibold mb-2">Khoảng giá:</h2>
            <div class="flex flex-wrap gap-2">
                @{
                    var priceRanges = new Dictionary<string, string>() {
                        {"duoi-2-trieu", "Dưới 2 triệu"},
                        {"2-5-trieu", "2 - 5 triệu"},
                        {"5-10-trieu", "5 - 10 triệu"},
                        {"10-20-trieu", "10 - 20 triệu"},
                        {"20-50-trieu", "20 - 50 triệu"},
                        {"tren-50-trieu", "Trên 50 triệu"}
                    };
                }
                @foreach (var range in priceRanges)
                {
                    var parameters = new Dictionary<string, string>();
                    
                    // Thêm các tham số cơ bản
                    if (!string.IsNullOrEmpty(Model.Category))
                        parameters.Add("category", Model.Category);
                    if (!string.IsNullOrEmpty(Model.Brand))
                        parameters.Add("brand", Model.Brand);
                    parameters.Add("priceRange", range.Key);
                    
                    // Kiểm tra và thêm các bộ lọc bổ sung (nếu có)
                    if (Model.AdditionalFilters != null)
                    {
                        if (Model.AdditionalFilters.ContainsKey("cpuSeries"))
                            parameters.Add("cpuSeries", Model.AdditionalFilters["cpuSeries"]);
                        if (Model.AdditionalFilters.ContainsKey("cores"))
                            parameters.Add("cores", Model.AdditionalFilters["cores"]);
                    }
                    
                    var url = Url.Action("Components", "ProductsList", parameters);
                    <a href="@url" class="px-4 py-2 bg-gray-100 rounded-md hover:bg-gray-200 @(Model.PriceRange == range.Key ? "bg-blue-600 text-white" : "")">
                        @range.Value
                    </a>
                }
            </div>
            <a href="@Url.Action("Components", "ProductsList", new { category = Model.Category })" class="inline-block mt-3 bg-red-500 text-white px-4 py-2 rounded-md hover:bg-red-600">
                Xóa bộ lọc
            </a>
        </div>
            

    </div>

    <!-- Products Grid -->
    <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4 mt-6">
        @if (Model.Products != null && Model.Products.Any())
        {
            var allProducts = Model.Products.ToList();
            for (int i = 0; i < allProducts.Count; i++)
            {
                var product = allProducts[i];
                var isHidden = i >= 10;
                <div class="product-item @(isHidden ? "hidden" : "")" data-index="@i">
                    <partial name="_ProductCard" model="@(new ProductCardViewModel {
                        IdSp = product.IdSp,
                        TenSp = product.Tensanpham,
                        Gia = product.Gia,
                        ImageUrl = product.Hinhanh,
                        LoaiSp = "components"
                    })" />
                </div>
            }
        }
        else
        {
            <div class="col-span-full text-center py-8 text-gray-500">
                Không tìm thấy sản phẩm nào phù hợp với tiêu chí tìm kiếm
            </div>
        }
    </div>

    @if (Model.Products != null && Model.Products.Count() > 10)
    {
        <div class="text-center mt-6">
            <button id="loadMoreBtn" class="bg-blue-500 text-white px-6 py-2 rounded-md hover:bg-blue-600 transition-colors duration-300">
                Xem thêm
            </button>
            <button id="collapseBtn" class="hidden bg-gray-500 text-white px-6 py-2 rounded-md hover:bg-gray-600 transition-colors duration-300 ml-2">
                Thu gọn
            </button>
        </div>
    }
</div>

@section Scripts {
    <script>
        // Removed the updateFilters function and its event listeners to avoid conflicting behavior.
        // We rely solely on the inline onchange handlers (which navigate to the URL generated by each option).

        document.addEventListener('DOMContentLoaded', function() {
            const loadMoreBtn = document.getElementById('loadMoreBtn');
            const collapseBtn = document.getElementById('collapseBtn');
            const products = document.querySelectorAll('.product-item');
            const productsPerPage = 10;
            let currentlyShown = productsPerPage;

            if (loadMoreBtn) {
                loadMoreBtn.addEventListener('click', function() {
                    // Calculate next batch of products to show
                    const nextBatch = Array.from(products)
                        .slice(currentlyShown, currentlyShown + productsPerPage);
                    
                    // Show next batch of products
                    nextBatch.forEach(product => {
                        product.classList.remove('hidden');
                    });

                    // Update counter
                    currentlyShown += productsPerPage;

                    // Hide "Xem thêm" button and show "Thu gọn" button if we've shown all products
                    if (currentlyShown >= products.length) {
                        loadMoreBtn.classList.add('hidden');
                        collapseBtn.classList.remove('hidden');
                    }
                });
            }

            if (collapseBtn) {
                collapseBtn.addEventListener('click', function() {
                    // Hide all products after the first 10
                    Array.from(products).forEach((product, index) => {
                        if (index >= productsPerPage) {
                            product.classList.add('hidden');
                        }
                    });

                    // Reset counter
                    currentlyShown = productsPerPage;

                    // Show "Xem thêm" button and hide "Thu gọn" button
                    loadMoreBtn.classList.remove('hidden');
                    collapseBtn.classList.add('hidden');

                    // Scroll back to the top of the products section
                    products[0].scrollIntoView({ behavior: 'smooth' });
                });
            }
        });
    </script>
}
