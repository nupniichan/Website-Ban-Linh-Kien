@model ProductListViewModel
@{
    ViewData["Title"] = "Thiết bị ngoại vi";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="container mx-auto px-4">
    <!-- Categories -->
    <div class="bg-white rounded-lg p-4">
        <h2 class="font-semibold mb-2">Danh mục:</h2>
        <div class="flex flex-wrap gap-2">
            <a href="@Url.Action("Peripherals", new { category = "keyboard" })" 
               class="px-4 py-2 bg-gray-100 rounded-md hover:bg-gray-200 @(Model?.Category == "keyboard" ? "bg-blue-600 text-white" : "")">
                Bàn phím
            </a>
            <a href="@Url.Action("Peripherals", new { category = "mouse" })"
               class="px-4 py-2 bg-gray-100 rounded-md hover:bg-gray-200 @(Model?.Category == "mouse" ? "bg-blue-600 text-white" : "")">
                Chuột
            </a>
            <a href="@Url.Action("Peripherals", new { category = "headphone" })"
               class="px-4 py-2 bg-gray-100 rounded-md hover:bg-gray-200 @(Model?.Category == "headphone" ? "bg-blue-600 text-white" : "")">
                Tai nghe
            </a>
        </div>
    </div>

    <!-- Filters -->
    <div class="bg-white rounded-lg p-4">
        <h2 class="font-semibold mb-2">Bộ lọc:</h2>
        @switch (Model?.Category?.ToLower())
        {
            case "keyboard":
                <div class="space-y-4">
                    <div class="flex flex-wrap gap-2">
                        <select id="brand" class="px-4 py-2 border rounded-md">
                            @{
                                var keyboardBrands = new[] {
                                    new { Value = "", Text = "Tất cả thương hiệu" },
                                    new { Value = "logitech", Text = "Logitech" },
                                    new { Value = "corsair", Text = "Corsair" },
                                    new { Value = "razer", Text = "Razer" },
                                    new { Value = "steelseries", Text = "SteelSeries" }
                                };
                            }
                            @foreach (var brand in keyboardBrands)
                            {
                                <option value="@brand.Value" selected="@(Model?.Brand == brand.Value)">@brand.Text</option>
                            }
                        </select>

                        <select id="type" class="px-4 py-2 border rounded-md">
                            @{
                                var keyboardTypes = new[] {
                                    new { Value = "", Text = "Tất cả loại" },
                                    new { Value = "mechanical", Text = "Cơ học" },
                                    new { Value = "membrane", Text = "Membrane" },
                                    new { Value = "optical", Text = "Optical" }
                                };
                            }
                            @foreach (var type in keyboardTypes)
                            {
                                <option value="@type.Value" selected="@(Model?.AdditionalFilters?.ContainsKey("type") == true && Model.AdditionalFilters["type"] == type.Value)">@type.Text</option>
                            }
                        </select>

                        <select id="connection" class="px-4 py-2 border rounded-md">
                            @{
                                var connections = new[] {
                                    new { Value = "", Text = "Tất cả kết nối" },
                                    new { Value = "wired", Text = "Có dây" },
                                    new { Value = "wireless", Text = "Không dây" },
                                    new { Value = "bluetooth", Text = "Bluetooth" }
                                };
                            }
                            @foreach (var conn in connections)
                            {
                                <option value="@conn.Value" selected="@(Model?.AdditionalFilters?.ContainsKey("connection") == true && Model.AdditionalFilters["connection"] == conn.Value)">@conn.Text</option>
                            }
                        </select>
                    </div>
                </div>
                break;

            case "mouse":
                <div class="space-y-4">
                    <div class="flex flex-wrap gap-2">
                        <select id="brand" class="px-4 py-2 border rounded-md">
                            @{
                                var mouseBrands = new[] {
                                    new { Value = "", Text = "Tất cả thương hiệu" },
                                    new { Value = "logitech", Text = "Logitech" },
                                    new { Value = "razer", Text = "Razer" },
                                    new { Value = "steelseries", Text = "SteelSeries" },
                                    new { Value = "corsair", Text = "Corsair" }
                                };
                            }
                            @foreach (var brand in mouseBrands)
                            {
                                <option value="@brand.Value" selected="@(Model?.Brand == brand.Value)">@brand.Text</option>
                            }
                        </select>

                        <select id="type" class="px-4 py-2 border rounded-md">
                            @{
                                var mouseTypes = new[] {
                                    new { Value = "", Text = "Tất cả loại" },
                                    new { Value = "gaming", Text = "Gaming" },
                                    new { Value = "office", Text = "Văn phòng" },
                                    new { Value = "ergonomic", Text = "Công thái học" }
                                };
                            }
                            @foreach (var type in mouseTypes)
                            {
                                <option value="@type.Value" selected="@(Model?.AdditionalFilters?.ContainsKey("type") == true && Model.AdditionalFilters["type"] == type.Value)">@type.Text</option>
                            }
                        </select>

                        <select id="connection" class="px-4 py-2 border rounded-md">
                            @{
                                var mouseConnections = new[] {
                                    new { Value = "", Text = "Tất cả kết nối" },
                                    new { Value = "wired", Text = "Có dây" },
                                    new { Value = "wireless", Text = "Không dây" },
                                    new { Value = "bluetooth", Text = "Bluetooth" }
                                };
                            }
                            @foreach (var conn in mouseConnections)
                            {
                                <option value="@conn.Value" selected="@(Model?.AdditionalFilters?.ContainsKey("connection") == true && Model.AdditionalFilters["connection"] == conn.Value)">@conn.Text</option>
                            }
                        </select>
                    </div>
                </div>
                break;

            case "headphone":
                <div class="space-y-4">
                    <div class="flex flex-wrap gap-2">
                        <select id="brand" class="px-4 py-2 border rounded-md">
                            @{
                                var headphoneBrands = new[] {
                                    new { Value = "", Text = "Tất cả thương hiệu" },
                                    new { Value = "logitech", Text = "Logitech" },
                                    new { Value = "razer", Text = "Razer" },
                                    new { Value = "steelseries", Text = "SteelSeries" },
                                    new { Value = "hyperx", Text = "HyperX" }
                                };
                            }
                            @foreach (var brand in headphoneBrands)
                            {
                                <option value="@brand.Value" selected="@(Model?.Brand == brand.Value)">@brand.Text</option>
                            }
                        </select>

                        <select id="type" class="px-4 py-2 border rounded-md">
                            @{
                                var headphoneTypes = new[] {
                                    new { Value = "", Text = "Tất cả loại" },
                                    new { Value = "over-ear", Text = "Over-ear" },
                                    new { Value = "in-ear", Text = "In-ear" },
                                    new { Value = "on-ear", Text = "On-ear" }
                                };
                            }
                            @foreach (var type in headphoneTypes)
                            {
                                <option value="@type.Value" selected="@(Model?.AdditionalFilters?.ContainsKey("type") == true && Model.AdditionalFilters["type"] == type.Value)">@type.Text</option>
                            }
                        </select>

                        <select id="connection" class="px-4 py-2 border rounded-md">
                            @{
                                var headphoneConnections = new[] {
                                    new { Value = "", Text = "Tất cả kết nối" },
                                    new { Value = "wired", Text = "Có dây" },
                                    new { Value = "wireless", Text = "Không dây" },
                                    new { Value = "bluetooth", Text = "Bluetooth" }
                                };
                            }
                            @foreach (var conn in headphoneConnections)
                            {
                                <option value="@conn.Value" selected="@(Model?.AdditionalFilters?.ContainsKey("connection") == true && Model.AdditionalFilters["connection"] == conn.Value)">@conn.Text</option>
                            }
                        </select>
                    </div>
                </div>
                break;

            default:
                <div class="text-gray-500">Vui lòng chọn danh mục để xem các bộ lọc chi tiết</div>
                break;
        }
    </div>

    <!-- Price Range -->
    <div class="bg-white rounded-lg p-4 mb-6">
        <h2 class="font-semibold mb-2">Khoảng giá:</h2>
        <div class="flex flex-wrap gap-2">
            <a href="@Url.Action("Peripherals", new { category = Model?.Category, priceRange = "duoi-500-nghin" })"
               class="px-4 py-2 bg-gray-100 rounded-md hover:bg-gray-200 @(Model?.PriceRange == "duoi-500-nghin" ? "bg-blue-600 text-white" : "")">
                Dưới 500 nghìn
            </a>
            <a href="@Url.Action("Peripherals", new { category = Model?.Category, priceRange = "500-1-trieu" })"
               class="px-4 py-2 bg-gray-100 rounded-md hover:bg-gray-200 @(Model?.PriceRange == "500-1-trieu" ? "bg-blue-600 text-white" : "")">
                500 nghìn - 1 triệu
            </a>
            <a href="@Url.Action("Peripherals", new { category = Model?.Category, priceRange = "1-2-trieu" })"
               class="px-4 py-2 bg-gray-100 rounded-md hover:bg-gray-200 @(Model?.PriceRange == "1-2-trieu" ? "bg-blue-600 text-white" : "")">
                1 - 2 triệu
            </a>
            <a href="@Url.Action("Peripherals", new { category = Model?.Category, priceRange = "2-5-trieu" })"
               class="px-4 py-2 bg-gray-100 rounded-md hover:bg-gray-200 @(Model?.PriceRange == "2-5-trieu" ? "bg-blue-600 text-white" : "")">
                2 - 5 triệu
            </a>
            <a href="@Url.Action("Peripherals", new { category = Model?.Category, priceRange = "tren-5-trieu" })"
               class="px-4 py-2 bg-gray-100 rounded-md hover:bg-gray-200 @(Model?.PriceRange == "tren-5-trieu" ? "bg-blue-600 text-white" : "")">
                Trên 5 triệu
            </a>
        </div>
    </div>

    <!-- Products Grid -->
    <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-6">
        @for (int i = 0; i < 15; i++)
        {
            <partial name="_ProductCard" />
        }
    </div>

    <!-- Pagination -->
    <div class="flex justify-center space-x-2 mt-6">
        @{
            string GetPageUrl(int pageNum)
            {
                var routeValues = new Dictionary<string, object>();
                
                if (!string.IsNullOrEmpty(Model?.Category))
                {
                    routeValues.Add("category", Model.Category);
                }
                
                if (!string.IsNullOrEmpty(Model?.Brand))
                {
                    routeValues.Add("brand", Model.Brand);
                }
                
                if (Model?.AdditionalFilters != null)
                {
                    foreach (var filter in Model.AdditionalFilters)
                    {
                        if (!string.IsNullOrEmpty(filter.Value))
                        {
                            routeValues.Add(filter.Key, filter.Value);
                        }
                    }
                }
                
                routeValues.Add("page", pageNum);
                
                return Url.Action("Peripherals", routeValues);
            }
        }

        <a href="@GetPageUrl(Model.CurrentPage - 1)" 
           class="px-4 py-2 bg-white rounded-md hover:bg-gray-50 @(Model.CurrentPage == 1 ? "opacity-50 cursor-not-allowed" : "")"
           @(Model.CurrentPage == 1 ? "disabled" : "")>
            <span class="sr-only">Previous</span>
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
            </svg>
        </a>

        @for (int i = 1; i <= Model.TotalPages; i++)
        {
            if (i == Model.CurrentPage)
            {
                <a href="@GetPageUrl(i)" class="px-4 py-2 bg-blue-600 text-white rounded-md">@i</a>
            }
            else if (i <= 3 || i == Model.TotalPages || Math.Abs(i - Model.CurrentPage) <= 1)
            {
                <a href="@GetPageUrl(i)" class="px-4 py-2 bg-white hover:bg-gray-50 rounded-md">@i</a>
            }
            else if (i == 4 || i == Model.TotalPages - 1)
            {
                <span class="px-4 py-2">...</span>
            }
        }

        <a href="@GetPageUrl(Model.CurrentPage + 1)" 
           class="px-4 py-2 bg-white rounded-md hover:bg-gray-50 @(Model.CurrentPage == Model.TotalPages ? "opacity-50 cursor-not-allowed" : "")"
           @(Model.CurrentPage == Model.TotalPages ? "disabled" : "")>
            <span class="sr-only">Next</span>
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
            </svg>
        </a>
    </div>
</div>

@section Scripts {
    <script>
        document.querySelectorAll('select').forEach(select => {
            select.addEventListener('change', function() {
                const params = new URLSearchParams(window.location.search);
                
                params.delete('brand');
                params.delete('type');
                params.delete('connection');
                params.delete('category');
                
                const currentPriceRange = '@Model?.PriceRange';
                if (currentPriceRange) {
                    params.set('priceRange', currentPriceRange);
                }
                
                document.querySelectorAll('select').forEach(s => {
                    if (s.value) {
                        params.set(s.id, s.value);
                    }
                });
                
                window.location.href = `${window.location.pathname}?${params.toString()}`;
            });
        });
    </script>
}

